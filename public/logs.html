<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Media Downloader • Live Logs</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { color-scheme: dark; }
    body { background-color: #0F172A; }
  </style>
</head>
<body class="min-h-screen bg-[#0F172A] text-slate-200">
  <header class="sticky top-0 z-40 backdrop-blur bg-slate-900/70 border-b border-slate-700/40">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-9 w-9 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 grid place-items-center shadow-lg shadow-blue-500/30">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-5 w-5 text-white"><path d="M4.5 19.5l6-6m0 0L9 9m1.5 4.5L15 15m-3-1.5l6-6"/></svg>
        </div>
        <div>
          <p class="text-white font-semibold leading-tight">Live Logs</p>
          <p class="text-xs text-slate-300/70">Media Downloader API • by Debraj</p>
        </div>
      </div>
      <a href="/" class="px-3 py-2 rounded-lg text-sm bg-blue-600 hover:bg-blue-500 text-white shadow shadow-blue-500/30">Back to Explorer</a>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-10">
    <section class="mb-4 flex flex-wrap items-center gap-3">
      <input id="search" placeholder="Search logs" class="w-60 bg-slate-900/60 border border-white/10 rounded-lg px-3 py-2 text-slate-100 placeholder-slate-500" />
      <label class="flex items-center gap-2 text-slate-300 text-sm">
        <input id="autoscroll" type="checkbox" checked /> Auto-scroll
      </label>
      <button id="refresh" class="px-3 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-white">Refresh</button>
      <span id="status" class="text-sm text-slate-400"></span>
    </section>

    <div id="logbox" class="rounded-xl border border-white/10 bg-black/40 min-h-[320px] max-h-[70vh] overflow-auto p-4 font-mono text-[13px] leading-relaxed"></div>
  </main>

  <script>
    const API_BASE = 'http://51.222.14.176:25576';
    const logbox = document.getElementById('logbox');
    const search = document.getElementById('search');
    const autoscroll = document.getElementById('autoscroll');
    const statusEl = document.getElementById('status');

    function badge(level) {
      const base = 'ml-2 text-[10px] font-semibold px-1.5 py-0.5 rounded border';
      if (level === 'ERROR') return `<span class="${base} bg-red-500/15 text-red-300 border-red-500/20">ERROR</span>`;
      if (level === 'WARNING') return `<span class="${base} bg-amber-500/15 text-amber-300 border-amber-500/20">WARNING</span>`;
      return `<span class="${base} bg-blue-500/15 text-blue-300 border-blue-500/20">INFO</span>`;
    }

    function tsPart(line) {
      const m = line.match(/^(\d{4}-\d{2}-\d{2}[^ ]*)/);
      return m ? `<span class="text-emerald-300 mr-2">${m[1]}</span>` : '';
    }

    function levelOf(line) {
      if (/error/i.test(line)) return 'ERROR';
      if (/warn|warning/i.test(line)) return 'WARNING';
      return 'INFO';
    }

    let lines = [];

    async function fetchLogs() {
      statusEl.textContent = 'Loading...';
      try {
        const res = await fetch(`${API_BASE}/logs.txt?_=${Date.now()}`);
        const text = await res.text();
        lines = text.split('\n').filter(Boolean);
        statusEl.textContent = '';
        render();
      } catch (e) {
        lines = [`ERROR fetching logs: ${e.message}`];
        statusEl.textContent = 'Failed to load';
        render();
      }
    }

    function render() {
      const q = (search.value || '').toLowerCase();
      const filtered = lines.filter(l => l.toLowerCase().includes(q));
      logbox.innerHTML = filtered.map(l => `<div class="whitespace-pre-wrap">${tsPart(l)}<span class="text-slate-200">${l}</span>${badge(levelOf(l))}</div>`).join('');
      if (autoscroll.checked) logbox.scrollTop = logbox.scrollHeight;
    }

    document.getElementById('refresh').addEventListener('click', fetchLogs);
    search.addEventListener('input', render);

    fetchLogs();
    setInterval(fetchLogs, 3000);
  </script>
</body>
</html>
